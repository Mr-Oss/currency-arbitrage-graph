(function(){var e,t,r;e=function(e){var t,r,n,a,o,c,i;for(r=[],a=0,o=e.length;o>a;a++)t=e[a],r.push("USD"+t);return c=r.map(function(e){return'"'+e+'"'}).join(", "),i="select * from yahoo.finance.xchange where pair in ("+c+")",n="store://datatables.org/alltableswithkeys",encodeURI("https://query.yahooapis.com/v1/public/yql?q="+i+"&format=json&env="+n)},r=function(e){return $.getJSON(e).then(function(e){var t;return t=e.query.results.rate,t.filter(function(e){return"N/A"!==e.Rate}).map(function(e){var t;return t=e.Name.split("/"),{from:t[0],to:t[1],rate:e.Rate}})})},t=function(e){var t,r,n,a;a={},e.forEach(function(e){return a[e.to]=e.rate}),n=[];for(t in a)for(r in a)n.push({from:t,to:r,rate:a[r]*(1/a[t])});return n},window.getCurrentFxRates=function(n){return r(e(n)).then(t)}}).call(this),function(){window.findNegativeCycles=function(e,t){var r,n,a,o,c,i,l,s,u,h,d,p,g,f,m,y,v,b,w,$,k,N,x,C,R,j,q,E,O,S,A,D;for(u=e.elements(),s=u.edges().stdFilter(function(e){return!e.isLoop()}),N=u.nodes(),E=N[0],r={},C={},x={},d=0,m=N.length;m>d;d++)$=N[d],r[$.id()]=1/0,C[$.id()]=void 0;for(r[E.id()]=0,p=1,R=N.length-1;R>=1?R>=p:p>=R;R>=1?p++:p--)for(g=0,y=s.length;y>g;g++)c=s[g],i=c.source().id(),l=c.target().id(),D=t.apply(c,[c]),O=math.add(r[i],D),math.smaller(O,r[l])&&(r[l]=O,C[l]=i,x[l]=c);for(h=!1,o={},f=0,v=s.length;v>f;f++)c=s[f],i=c.source().id(),l=c.target().id(),D=t.apply(c,[c]),O=math.add(r[i],D),math.smaller(O,r[l])&&(r[l]=O,h=!0,o[l]=!0);for(a=[],j=Object.keys(o),w=0,b=j.length;b>w;w++){for(k=j[w],A={},n=[],S=k;null!=S&&!A[S];)n.push(e.getElementById(S)),n.push(x[S]),A[S]=!0,S=C[S];n.pop(),n.push(e.getElementById(n[0].id()+"/"+n[n.length-1].id())),n.push(n[0]),n.reverse(),a.push(new cytoscape.Collection(e,n))}return q={hasNegativeWeightCycle:h,cycles:a}}}.call(this),function(){var e,t,r,n,a,o,c,i,l,s,u;r=$("#graph"),t=$("#data-source-info"),n=$("#graph-placeholder"),e=$("#arbitrage-opportunities"),u=function(){var e;return e='<div class="center-block" style="width: 20%">\n  <h3>Loading Graph</h3>\n  <div class="progress">\n    <div class="progress-bar progress-bar-striped active" role="progressbar" style="width: 100%">\n      <span class="sr-only">Loading graph</span>\n    </div>\n  </div>\n</div>',function(){return n.html(e)}}(),c=function(){return n.empty()},o=function(){return $.getJSON("data/currencies.min.json")},a=function(){var t,n,a,o,c,i;return o=r.cytoscape("get"),i=findNegativeCycles(o,function(e){return-1*Math.log(e.data("rate"))}),t=$("<div>").attr("class","list-group"),e.empty().append("<h3>Arbitrage Opportunities</h3>").append(t),a=[],i.hasNegativeWeightCycle&&(a=function(){var e,t,r,n;for(r=i.cycles,n=[],e=0,t=r.length;t>e;e++)c=r[e],n.push({multiplier:c.edges().map(function(e){return e.data("rate")}).reduce(function(e,t){return e*t}),cycle:c});return n}(),a=function(){var e,t,r;for(r=[],e=0,t=a.length;t>e;e++)n=a[e],n.multiplier>1&&r.push(n);return r}()),a.length>0?(a.sort(function(e,t){return math.subtract(t.multiplier,e.multiplier)}),a.forEach(function(e){return t.append($("<a>").attr("href","#").attr("class","list-group-item").click(function(){return o.elements().unselect(),e.cycle.select()}).append($("<p>").html(e.cycle.nodes().map(function(e){return e.id()}).join(" &rarr; "))).append($("<p>").text("With 1 unit of the starting currency, you get ~"+e.multiplier.toFixed(4)+" units")))}),e.append("<p>Note: All possible arbitrage opportunities may not be shown.</p>")):e.append("<p>No arbitrage opportunities available.</p>")},l=function(e,t,n){var o,c;return r.height($(document).height()-150).cytoscape({layout:{name:"circle"},style:cytoscape.stylesheet().selector("node").css({width:50,height:33.25,shape:"rectangle","background-image":"data(flag_image)","background-fit":"cover"}).selector("node:selected").css({content:"data(name)","border-width":2}).selector("edge").css({"target-arrow-shape":"triangle"}).selector("edge:selected").css({content:"data(rate)","line-color":"black","target-arrow-color":"black"}),elements:{nodes:function(){var t,r,a;for(a=[],t=0,r=e.length;r>t;t++)o=e[t],c=n[o],a.push({data:{id:o,name:c.name,country:c.country,flag_image:"images/"+c.flag_image}});return a}(),edges:t.map(function(e){return{data:{id:e.from+"/"+e.to,source:e.from,target:e.to,rate:e.rate}}})}}),a()},i=function(e,n){return r.empty(),u(),$.getJSON("data/demo"+e+".json").then(function(e){return t.html("Example data from <a target='_blank' href='"+e.source.url+"'>"+e.source.name+"</a>."),c(),l(e.currencies,e.rates,n)})},(s=function(){var e;return e=$("#currency-list-select"),o().then(function(n){var a;return a=["CAD","CHF","EUR","GBP","HKD","INR","JPY","KRW","QAR","SGD","USD"],e.select2({data:Object.keys(n).map(function(e){return{id:e,text:e+": "+n[e].name}})}),e.select2("val",a),$("#load-real-data-graph").click(function(){var a;return a=e.val(),null==a||a.length<2?console.log("Must include at least two currencies to get exchange rates"):(r.empty(),u(),getCurrentFxRates(a).then(function(e){return t.html("Latest currency exchange rate data from the <a target='_blank' href='https://developer.yahoo.com/yql/console/?q=show%20tables&env=store://datatables.org/alltableswithkeys#h=desc+yahoo.finance.xchange'> yahoo.finance.xchange community datatable on the Yahoo Query Language platform</a>."),c(),l(a,e,n)}))}),$("#load-demo-1").click(function(){return i(1,n)}),$("#load-demo-2").click(function(){return i(2,n)})})})()}.call(this);